
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>PCSC BRIDGE</title>
    <!-- <script type="text/javascript" src="XXX.js"></script> -->
  </head>
  
  
  <script type="text/javascript">
    var bridge;
    var reader;
    function load() {
      bridge =  getPCSCBridge();
      bridge.init();
    }

    function getPCSCBridge() {
      return document.getElementById('pcscbridge');
    }

    function pluginLoaded() {
      alert("PCSC Bridge Plugin loaded!");
    }

    function listReaders() {
      var list = bridge.listReaders(); 
      var opts =  document.forms["readers"].rlst.options;
      opts.length = 0;
      list.forEach(function (r) {
        opts[opts.length] = new Option(r,r,false,false);
      });
    }

    function powerUp() {
      var r = document.forms["readers"].rlst
      reader = bridge.selectReader(r.options[r.selectedIndex].value);
      var atr = reader.powerUp();
      document.forms["atr"].atr.value = atr;
    }

    function powerDown() {
      if (reader) {
        reader.powerDown();
       }
      document.forms["atr"].atr.value = "";
    }

    function exchangeAPDU() {
      var xch = document.forms["xch"];
      reader.autoGetResponse = xch.autogetresp.checked;
      reader.autoReissue     = xch.autoreissue.checked;
      resp = reader.exchangeAPDU(xch.in.value, xch.extended.checked);
      xch.out.value = resp;
    }

  </script>  
  
  <body onload="load()">

    <object id="pcscbridge" type="application/x-pcscbridge" width="0" height="0">
      <param name="onload" value="pluginLoaded" />
    </object><br />

    <h1>Readers</h1>
    <form name="readers" onsubmit="return false">
      <select name="rlst">
      </select><br/>
      <input type="submit" value="Get reader list" onclick="listReaders()">
    </form>

    <h1>Power</h1>
    <form name="atr" onsubmit="return false">
      <input type="text" name="atr" size="80" readonly><br/>
      <input type="submit" value="up" onclick="powerUp()">
      <input type="submit" value="down" onclick="powerDown()">
    </form>

    <h1>Exchange</h1>
    <!-- 00A4040006D27600012401  -->
    <form name="xch" onsubmit="return false">
      <pre>
        00A4040006D27600012401 
        00CA004F00
        00CA006E00        
      </pre>
      auto Reissue <input type="checkbox" name="autoreissue"/> <br/>
      auto GetResponse <input type="checkbox" name="autogetresp"/> <br/>
      extended <input type="checkbox" name="extended"/> <br/>
      in : <input type="text" name="in"  size="150" ><br/>
      out: <input type="text" name="out" size="150" ><br/>
      <input type="submit" value="exchange" onclick="exchangeAPDU()">
    </form>
    
  </body>
</html>
